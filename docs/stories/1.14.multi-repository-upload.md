# Story 1.14: Subida a MÃºltiples Repositorios

## Status

Draft

## Story

**As a** Release Manager,
**I want** to upload a single artifact and have it simultaneously published to multiple repositories (e.g., a release repository and a staging repository),
**so that** I can streamline promotion workflows and ensure consistency across environments.

## Acceptance Criteria

1. The upload API must accept a parameter specifying multiple target repository IDs.
2. The system must treat the upload as a single logical transaction.
3. An identical `PhysicalArtifact` should be created once, and then referenced by new `PackageVersion` entries in each target repository.
4. Authorization must be checked for write permissions on *all* specified repositories before the operation begins.
5. If the user lacks permission for even one repository, the entire operation must be rejected.
6. The response should indicate the success or failure for each target repository.
7. Individual `ArtifactUploaded` events should be published for each repository where the artifact was successfully published.

## Tasks / Subtasks

- [ ] Modify the upload API to accept an array of repository IDs.
- [ ] Implement the authorization logic to check permissions across all target repositories.
- [ ] Update the artifact creation logic to create multiple `PackageVersion` instances pointing to a single `PhysicalArtifact`.
- [ ] Wrap the multi-repository publication in a database transaction to ensure atomicity.
- [ ] Write integration tests for multi-repository upload scenarios.

## Dev Notes

### Data Models
- This leverages the existing `PackageVersion` and `PhysicalArtifact` models, creating multiple `PackageVersion` instances.

### API Specifications
- **Endpoint**: `POST /artifacts` (modified)
- A new field, e.g., `target_repository_hrns: ["hrn:...", "hrn:..."]`, will be added to the metadata part of the request.