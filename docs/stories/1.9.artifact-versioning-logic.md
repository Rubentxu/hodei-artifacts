# Story 1.9: Lógica de Versionado de Artefactos

## Status

✅ Implemented

## Story

**As a** Repository Administrator,
**I want** the system to understand and enforce semantic versioning rules for artifacts,
**so that** I can maintain a clean, predictable, and well-organized repository.

## Acceptance Criteria

1. The system must parse the version string from the artifact's coordinates.
2. It should validate if the version follows Semantic Versioning (SemVer 2.0.0) standards.
3. The repository can be configured to reject non-SemVer versions.
4. The system should correctly handle pre-release tags (e.g., `1.0.0-alpha.1`) and build metadata (e.g., `1.0.0+build.123`).
5. The system should differentiate between SNAPSHOT and release versions, especially for Maven repositories.
6. Repository policies can be defined based on versioning (e.g., "Allow only one SNAPSHOT per major.minor version").

## Tasks / Subtasks

- [x] Integrate a SemVer parsing library (e.g., the `semver` crate).
- [x] Add version validation logic to the artifact upload workflow.
- [x] Add repository-level configuration to enable/disable strict SemVer enforcement.
- [x] Implement logic to handle SNAPSHOT versions.
- [x] Write unit tests for parsing and validating a wide range of version strings.

## Dev Notes

### Implementation Details
- ✅ **VSA Architecture**: Implemented following Vertical Slice Architecture patterns
- ✅ **Trait-based Design**: Created `VersionValidator` trait in `ports.rs` for interface segregation
- ✅ **Default Implementation**: `DefaultVersionValidator` using `semver` crate for SemVer 2.0.0 compliance
- ✅ **Mock Implementation**: `MockVersionValidator` for testing scenarios
- ✅ **Dependency Injection**: Integrated into all use cases via dependency injection
- ✅ **Error Handling**: Proper error propagation with `UploadArtifactError::ValidationFailed`
- ✅ **SNAPSHOT Support**: Case-insensitive detection of SNAPSHOT versions
- ✅ **Comprehensive Testing**: 28 test functions covering all scenarios

### Data Models
- The `PackageCoordinates.version` field is the primary input for this story.
- The `Repository.config` might be extended to include versioning policies.
- Added `ParsedVersion` struct for detailed version information extraction

### Test Coverage
- ✅ **Unit Tests**: Complete coverage for both default and mock validators
- ✅ **Integration Tests**: Version validation integrated into upload workflow
- ✅ **Happy Path**: All SemVer 2.0.0 formats supported
- ✅ **Error Scenarios**: Invalid versions properly rejected with meaningful errors
- ✅ **Edge Cases**: Maximum versions, empty strings, special characters
- ✅ **SNAPSHOT Detection**: Case-insensitive SNAPSHOT version handling

### Files Modified
- `crates/artifact/src/features/upload_artifact/ports.rs` - Added `VersionValidator` trait
- `crates/artifact/src/features/upload_artifact/adapter/version_validator.rs` - Default implementation
- `crates/artifact/src/features/upload_artifact/test_adapter.rs` - Mock implementation
- `crates/artifact/src/features/upload_artifact/use_case.rs` - Integration with upload flow
- `crates/artifact/src/features/upload_artifact/di.rs` - Dependency injection setup
- Multiple test files with comprehensive test coverage