# Story 6.1: Vulnerability Scanner Orchestration Engine

## Status
- Draft

## Story
**Como** un Ingeniero de Seguridad de Aplicaciones (AppSec),
**quiero** que cada artefacto sea analizado por un conjunto de escáneres de vulnerabilidades apropiados para su tipo (contenedores, paquetes de Rust, etc.), de forma automática y en paralelo,
**para** obtener la cobertura de análisis más completa y precisa posible, identificando riesgos de forma proactiva en nuestra cadena de suministro de software.

## Acceptance Criteria
1.  Un evento `ArtifactUploaded` debe disparar el caso de uso de escaneo de vulnerabilidades.
2.  El caso de uso debe determinar el tipo de artefacto y despachar el escaneo a los escáneres relevantes a través de un `port` de abstracción.
3.  Los resultados de todos los escáneres ejecutados deben ser normalizados y consolidados en un único informe, deduplicando hallazgos.
4.  El informe de vulnerabilidades final debe guardarse de forma persistente utilizando un `port` de repositorio.
5.  La implementación concreta de los escáneres (adaptadores) debe estar aislada de la lógica del caso de uso.
6.  Debe existir un endpoint en la API para consultar el informe consolidado (será una "feature slice" separada, `get_vulnerability_report`).

## Tasks / Subtasks
- [ ] Tarea 1: Configurar el Bounded Context `security_management`.
- [ ] Tarea 2: Definir los modelos de dominio (`Vulnerability`, `VulnerabilityReport`).
- [ ] Tarea 3: Construir la "Vertical Slice" para la feature `scan_for_vulnerabilities`.
- [ ] Tarea 4: Definir las Abstracciones (Ports) en `ports.rs` (`trait IScanner`, `trait IScannerProvider`, `trait IVulnerabilityRepository`).
- [ ] Tarea 5: Implementar los Adaptadores (Concreciones) en `adapter.rs` (`TrivyScannerAdapter`, `CargoAuditScannerAdapter`, `MongoVulnerabilityRepository`).
- [ ] Tarea 6: Desarrollar el Caso de Uso en `use_case.rs` (`ScanForVulnerabilitiesUseCase`).
- [ ] Tarea 7: Conectar el punto de entrada en `api.rs` (manejador de eventos).
- [ ] Tarea 8: Pruebas (unitarias con mocks y de integración para los adaptadores).

## Dev Notes
### Guía de Implementación Avanzada (Vertical Slice Architecture)
**Decisión Arquitectónica Clave: Adopción de VSA y Ports & Adapters**
Esta historia se implementará como una "slice" vertical totalmente aislada dentro del Bounded Context de `security_management`.

**Estructura de Directorios para esta Feature:**


crates/
└── security_management/
├── src/
│   ├── domain/
│   │   └── vulnerability.rs
│   └── features/
│       └── scan_for_vulnerabilities/
│           ├── use_case.rs
│           ├── ports.rs
│           ├── adapter.rs
│           └── api.rs


**Flujo de Inversión de Dependencias:**
El `use_case` orquesta la lógica de negocio sin conocer ningún detalle de implementación, dependiendo exclusivamente de las abstracciones definidas en `ports.rs`.
```rust
// en features/scan_for_vulnerabilities/use_case.rs
pub struct ScanForVulnerabilitiesUseCase {
    scanner_provider: Arc<dyn IScannerProvider>,
    repository: Arc<dyn IVulnerabilityRepository>,
}
```
