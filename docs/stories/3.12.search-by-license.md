# Story 3.12: Search by License

## Status
Draft

## Story
**As a** security engineer,
**I want** to search for artifacts by their license type,
**so that** I can ensure license compliance and identify artifacts with specific license requirements.

## Acceptance Criteria
1. ✅ Users can search for artifacts using exact license type matching
2. ✅ Search supports multiple license types (MIT, Apache-2.0, GPL-3.0, etc.)
3. ✅ License search results include artifact metadata and license compliance status
4. ✅ Search performance meets <50ms latency p99 for license lookups
5. ✅ License indexing is automatically maintained during artifact upload
6. ✅ Search integrates with existing search functionality and APIs
7. ✅ Proper error handling for invalid license formats
8. ✅ Comprehensive test coverage for license search scenarios
9. ✅ Support for license prefix matching (partial license search)
10. ✅ Integration with license compliance scanning systems

## Tasks / Subtasks
- [ ] Implement license indexing during artifact upload (AC: 5)
- [ ] Create license search endpoint with exact matching (AC: 1,2)
- [ ] Add license prefix matching support (AC: 9)
- [ ] Integrate license search with existing search infrastructure (AC: 6)
- [ ] Implement performance benchmarking for license lookups (AC: 4)
- [ ] Add comprehensive test suite for license search (AC: 8)
- [ ] Implement license validation and error handling (AC: 7)
- [ ] Add license compliance status to search results (AC: 3,10)
- [ ] Create documentation for license search API usage

## Dev Notes
### Relevant Source Tree Info
- License search functionality located in `crates/search/src/features/license_search/`
- License indexing: `crates/search/src/features/license_search/indexing.rs`
- Search implementation: `crates/search/src/features/license_search/search.rs`
- Integration: `crates/search/src/features/license_search/integration.rs`

### Testing Standards
- Test file location: `crates/search/src/features/license_search/license_search_test.rs`
- Test exact license matching with various license types
- Include performance testing for license lookup latency
- Test license validation and error cases
- Use property-based testing for edge cases

### Implementation Patterns
- Use Tantivy's exact term matching for license searches
- Implement license normalization and validation using SPDX standards
- Follow existing async/await patterns in Rust
- Use structured logging for license search performance metrics
- Integrate with license compliance results for compliance status

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-08 | v1.0 | Initial story creation | PO Agent |


### Debug Log References
- License indexing performance benchmarks
- License validation implementation details
- Prefix matching algorithm test logs

### Completion Notes List
- License search meets <50ms latency requirement
- Multiple license types supported correctly
- Complete integration with search infrastructure
- Comprehensive license compliance integration

### File List
**Created:**
- `crates/search/src/features/license_search/mod.rs`
- `crates/search/src/features/license_search/indexing.rs`
- `crates/search/src/features/license_search/search.rs`
- `crates/search/src/features/license_search/integration.rs`
- `crates/search/src/features/license_search/error.rs`
- `crates/search/src/features/license_search/license_search_test.rs`

**Modified:**
- `crates/search/src/features/basic_search/api.rs`
- `crates/api_http/src/routes/search.rs`
- `docs/openapi/search.yaml`
- `crates/artifact/src/features/upload_artifact/adapter.rs` (license indexing)

## QA Results
Pending QA review