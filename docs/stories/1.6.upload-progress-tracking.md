# Story 1.6: Seguimiento del Progreso de Subida

## Status

âœ… **Implemented** - 2025-09-10

**Feature ID:** E1.F06  
**Ã‰pica:** E1 - Artifact Lifecycle Management  
**Puntos:** 3 pts  
**Dependencias:** E1.F02 (Upload Multipart)

## Story

**As a** Developer using the UI or a CI/CD System,
**I want** to track the real-time progress of my artifact uploads,
**so that** I can monitor the status and estimate the completion time, especially for large files.

## Acceptance Criteria

âœ… 1. The system must provide a mechanism to query the progress of an ongoing upload.  
   - **Implementado:** Endpoint REST `GET /uploads/{upload_id}/progress`
   
âœ… 2. This could be via a separate endpoint or a WebSocket connection.  
   - **Implementado:** Soporte dual - REST polling + WebSocket para tiempo real
   
âœ… 3. The progress should include bytes transferred and total file size.  
   - **Implementado:** Incluye bytes transferidos, total, porcentaje, ETA y estado
   
ðŸ”¶ 4. The frontend should display a progress bar for uploads initiated from the UI.  
   - **Backend completado:** API lista para consumo frontend
   
âœ… 5. An `UploadProgressUpdated` event should be published internally to facilitate this.  
   - **Implementado:** Eventos publicados via `ProgressEventPublisher`
   
âœ… 6. The tracking mechanism should be secure and only allow the uploader to see the progress.  
   - **Implementado:** AutorizaciÃ³n por usuario, solo el uploader puede ver progreso

## Tasks / Subtasks

- [x] Design the progress tracking mechanism (e.g., WebSocket vs. polling endpoint).
- [x] Implement the `UploadProgressUpdated` event emission during the streaming upload process.
- [x] Create a service to manage and broadcast progress updates.
- [x] Secure the progress tracking endpoint/channel.
- [ ] Implement a progress bar component in the frontend.
- [x] Write tests for the progress tracking functionality.

## Dev Notes

### Implementation Details
- **Architecture**: Implemented following Vertical Slice Architecture with Clean Architecture principles
- **API Endpoints**: 
  - `GET /uploads/{upload_id}/progress` - REST polling for progress
  - `GET /uploads/progress` - List active upload sessions
  - `POST /uploads/{upload_id}/subscribe` - WebSocket subscription for real-time updates
  - `DELETE /uploads/{client_id}/unsubscribe` - WebSocket unsubscription
- **Progress Service**: Centralized service managing upload sessions with memory, PostgreSQL, and in-memory implementations
- **Event System**: Integrated with existing RabbitMQ event publisher for internal `UploadProgressUpdated` events
- **Security**: User-based authorization ensuring only upload owners can access progress
- **Integration**: Seamlessly integrated with existing multipart upload functionality

### API Specifications
- **New Endpoint/Channel**: `GET /uploads/{upload_id}/progress` or a WebSocket at `ws /uploads/progress`.
- The `upload_id` would be generated and returned when the upload is initiated.

### Technical Constraints
- The progress reporting should not add significant overhead to the upload process.
- The solution must scale to handle many concurrent uploads.

### Performance Considerations
- Progress updates throttled to every 10% to minimize overhead
- Memory-efficient session management with automatic cleanup
- WebSocket connections managed with connection pooling
- Support for multiple storage backends (memory, PostgreSQL, Kafka) for different deployment scenarios