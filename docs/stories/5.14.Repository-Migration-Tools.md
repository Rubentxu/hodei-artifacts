# Story 5.14: Repository Migration Tools

## Status
- Draft

## Story
**Como** un Administrador de Sistemas,
**quiero** una herramienta de línea de comandos (CLI) para migrar mis repositorios existentes desde Sonatype Nexus 3 a este nuevo sistema,
**para** poder adoptar la nueva plataforma sin perder mi historial de artefactos y minimizando el trabajo manual.

## Acceptance Criteria
1.  Debe existir una herramienta CLI ejecutable (`migration-tool`) que pueda conectarse a una instancia de Sonatype Nexus 3 (usando su API REST).
2.  La herramienta debe ser capaz de listar los repositorios disponibles en la instancia de Nexus de origen.
3.  La herramienta debe poder migrar un repositorio Nexus seleccionado, creando un repositorio equivalente en el nuevo sistema y copiando todos sus artefactos.
4.  El proceso de migración debe ser reanudable. Si se interrumpe, al volver a ejecutarlo, debe continuar desde donde se quedó sin duplicar artefactos ya migrados.
5.  La herramienta debe proporcionar un feedback detallado del progreso en la terminal (ej: barra de progreso, artefactos procesados, errores).
6.  Debe existir una guía de usuario (`MIGRATION_GUIDE.md`) que explique cómo configurar y ejecutar la herramienta.

## Tasks / Subtasks
- [ ] Tarea 1: Crear el esqueleto de la herramienta CLI. (AC: 1)
    - [ ] Subtarea 1.1: Crear un nuevo binario `migration-tool` en el workspace de Cargo.
    - [ ] Subtarea 1.2: Integrar la librería `clap` para parsear los argumentos de la línea de comandos (URL de origen, credenciales, repositorio a migrar, etc.).
- [ ] Tarea 2: Implementar el módulo "Extractor" para Nexus 3. (AC: 2)
    - [ ] Subtarea 2.1: Crear un cliente de API para Nexus 3 en Rust, enfocado en los endpoints para listar repositorios y listar los componentes/artefactos de un repositorio.
    - [ ] Subtarea 2.2: Implementar la lógica de paginación para manejar repositorios con un gran número de artefactos.
- [ ] Tarea 3: Implementar el módulo "Loader" para nuestro sistema. (AC: 3)
    - [ ] Subtarea 3.1: Reutilizar o crear un cliente de API para nuestro propio sistema.
    - [ ] Subtarea 3.2: Implementar la función `load_artifact`, que recibe un artefacto descargado del origen y lo sube al repositorio de destino en nuestro sistema.
- [ ] Tarea 4: Implementar el orquestador principal de la migración y el estado reanudable. (AC: 3, 4, 5)
    - [ ] Subtarea 4.1: Implementar la lógica principal que utiliza el Extractor para obtener la lista de artefactos y luego itera sobre ella.
    - [ ] Subtarea 4.2: Antes de procesar cada artefacto, la herramienta debe registrar su intención en un archivo de estado local (ej: un simple archivo de log o una base de datos SQLite embebida).
    - [ ] Subtarea 4.3: El orquestador debe descargar el binario del artefacto de Nexus y luego pasarlo al Loader para subirlo.
    - [ ] Subtarea 4.4: Una vez que el Loader confirma la subida, se marca el artefacto como "COMPLETADO" en el archivo de estado. Al iniciar, la herramienta siempre lee este archivo para saltarse los artefactos ya completados.
- [ ] Tarea 5: Escribir la documentación. (AC: 6)
    - [ ] Subtarea 5.1: Crear el `MIGRATION_GUIDE.md` con ejemplos claros de uso.
- [ ] Tarea 6: Pruebas.
    - [ ] Subtarea 6.1: Pruebas unitarias para el cliente de API de Nexus usando respuestas JSON mockeadas.
    - [ ] Subtarea 6.2: Probar la lógica de reanudación: iniciar una migración, interrumpirla y verificar que al reanudarla no se re-procesen los artefactos ya migrados.

## Dev Notes

### Guía de Implementación y Contexto Arquitectónico

**Decisión Arquitectónica Clave: Herramienta CLI Externa con Arquitectura ETL**
Una migración es una tarea operativa, puntual y de larga duración. No debe ser parte del servicio principal. Una **CLI dedicada** es la solución ideal. La arquitectura interna de la CLI debe seguir el patrón **ETL (Extract, Transform, Load)**:
-   **Extract**: El código que se comunica con la API de Nexus 3. Es el único componente que conoce los detalles de Nexus.
-   **Transform**: En este caso, la transformación es mínima, principalmente mapear tipos de repositorio y metadatos.
-   **Load**: El código que usa la API de nuestro propio sistema para escribir los datos.

Este diseño modular permitirá en el futuro añadir soporte para otros sistemas de origen (ej. JFrog Artifactory) simplemente escribiendo un nuevo módulo "Extractor" sin cambiar el resto de la herramienta.

**Ejemplo de API de Nexus 3 a utilizar:**
El Extractor necesitará interactuar con la API REST de Nexus 3. Los endpoints clave son:
-   `GET /service/rest/v1/repositories`: Para listar los repositorios.
-   `GET /service/rest/v1/components?repository={repo_name}`: Para listar los componentes (artefactos) de un repositorio. Este endpoint usa un `continuationToken` para la paginación.
-   El campo `assets[0].downloadUrl` en la respuesta del endpoint de componentes contiene la URL para descargar el binario del artefacto.

**Gestión del Estado para la Reanudación:**
La forma más simple y robusta de hacer el proceso reanudable es mantener un archivo de log local.
```text
# migration-state.log
START_ARTIFACT: maven-central/commons-logging/commons-logging/1.2/commons-logging-1.2.jar
...descargando...
...subiendo...
END_ARTIFACT: maven-central/commons-logging/commons-logging/1.2/commons-logging-1.2.jar
START_ARTIFACT: ...