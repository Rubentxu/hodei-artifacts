# Story 1.17: Resoluci√≥n de Conflictos de Subida

## Status

Draft

## Story

**As a** Repository Administrator,
**I want** to configure specific conflict resolution strategies for when a user tries to upload an artifact version that already exists,
**so that** I can control whether re-deployments are allowed and prevent accidental overwrites.

## Acceptance Criteria

1. Repositories must have a configurable "Deployment Policy" (e.g., `AllowRedeploy`, `BlockRedeploy`).
2. If the policy is `BlockRedeploy` and an artifact with the same coordinates (`name`, `version`, etc.) is uploaded, the upload must be rejected with a 409 Conflict error.
3. If the policy is `AllowRedeploy`, the new artifact will replace the old one.
4. When a re-deployment occurs, the old `PackageVersion` should be marked as `Deprecated` or `Archived`, and a new `PackageVersion` is created.
5. An `UploadConflictDetected` event should be published when a conflict occurs.
6. If the conflict is resolved by re-deploying, an `UploadConflictResolved` event should be published.

## Tasks / Subtasks

- [ ] Add the `DeploymentPolicy` configuration to the `Repository` model.
- [ ] In the upload workflow, check for an existing `PackageVersion` with the same coordinates.
- [ ] Implement the logic to either reject the upload or handle the replacement based on the policy.
- [ ] Implement the status change for the old `PackageVersion`.
- [ ] Publish the `UploadConflictDetected` and `UploadConflictResolved` events.
- [ ] Write integration tests for both `AllowRedeploy` and `BlockRedeploy` scenarios.

## Dev Notes

### Data Models
- The `RepositoryConfig` in the `repository` domain will be extended to include the `DeploymentPolicy`.