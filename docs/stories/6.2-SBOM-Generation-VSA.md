# Story 6.2: SBOM Generation

## Status
- Draft

## Story
**Como** un Manager de Release,
**quiero** que se genere automáticamente un Software Bill of Materials (SBOM) para cada artefacto que se sube al sistema,
**para** poder tener un inventario completo de todas las dependencias de nuestro software, cumplir con los estándares de la industria y facilitar el análisis de seguridad.

## Acceptance Criteria
1.  Un evento `ArtifactUploaded` debe disparar el caso de uso de generación de SBOM.
2.  El caso de uso debe invocar a un generador de SBOM (inicialmente, `syft`) a través de un `port`.
3.  El SBOM generado debe estar en formato CycloneDX (JSON).
4.  El SBOM resultante debe ser guardado de forma persistente a través de un `port` de repositorio.
5.  La implementación del repositorio (adapter) debe guardar el archivo SBOM en el almacenamiento de objetos (S3) y actualizar los metadatos del artefacto en la base de datos con una referencia.
6.  Debe existir un endpoint en la API que permita a los usuarios descargar el SBOM (será una "feature slice" separada).

## Tasks / Subtasks
- [ ] Tarea 1: Definir los modelos de dominio (`Sbom`, `ArtifactId`) en `security_management/src/domain/`.
- [ ] Tarea 2: Construir la "Vertical Slice" para la feature `generate_sbom`.
- [ ] Tarea 3: Definir las Abstracciones (Ports) en `ports.rs` (`trait ISbomGenerator`, `trait ISbomRepository`).
- [ ] Tarea 4: Implementar los Adaptadores (Concreciones) en `adapter.rs` (`SyftSbomGenerator`, `MongoSbomRepository`).
- [ ] Tarea 5: Desarrollar el Caso de Uso en `use_case.rs` (`GenerateSbomUseCase`).
- [ ] Tarea 6: Conectar el punto de entrada en `api.rs` (manejador de eventos).
- [ ] Tarea 7: Pruebas (unitarias con mocks y de integración para los adaptadores).

## Dev Notes
### Guía de Implementación Avanzada (Vertical Slice Architecture)
**Estructura de Directorios para esta Feature:**


crates/
└── security_management/
├── src/
│   ├── domain/
│   │   └── sbom.rs
│   └── features/
│       └── generate_sbom/
│           ├── use_case.rs
│           ├── ports.rs
│           ├── adapter.rs
│           └── api.rs


**Flujo de Inversión de Dependencias:**
El `use_case` depende únicamente de abstracciones, permitiendo probar la lógica de negocio de forma aislada y cambiar la implementación del generador de SBOM sin tocar el caso de uso.
```rust
// en features/generate_sbom/use_case.rs
pub struct GenerateSbomUseCase {
    generator: Arc<dyn ISbomGenerator>,
    repository: Arc<dyn ISbomRepository>,
}
```
