### **Historia 4.22: Policy Documentation Generator**

#### **Proceso de Creación**
* **Identificada siguiente historia:** 4.22 - Policy Documentation Generator.
* **Recopilación:** Esta historia se centra en la usabilidad para los administradores. El objetivo es traducir la sintaxis formal de una política de Cedar a una descripción en lenguaje natural, haciendo más fácil para los humanos entender lo que hace cada regla.
* **Checklist:** Ejecutando la `story-draft-checklist`... **Resultado:** ✅ **LISTA**.

#### **Archivo: `docs/stories/4.22.Policy-Documentation-Generator.md`**

# Historia 4.22: Policy Documentation Generator

## Estado
- **Borrador (Draft)**

## Historia
**Como** administrador de políticas,
**quiero** generar automáticamente una descripción en lenguaje natural de una política de Cedar,
**para que** pueda entender rápidamente el propósito y el efecto de una regla sin tener que analizar la sintaxis detallada.

## Criterios de Aceptación
1.  Se ha creado un `PolicyDocGenerator` que toma como entrada una cadena de política de Cedar.
2.  El generador parsea la política para extraer sus componentes principales: efecto (`permit`/`forbid`), `principal`, `action`, y `resource`.
3.  El generador también extrae y utiliza las anotaciones `@doc` dentro de la política, si existen.
4.  El servicio genera una descripción concisa en lenguaje natural (p. ej., "Esta política permite al principal X realizar la acción Y sobre el recurso Z.").
5.  Existe un endpoint de API (`POST /api/v1/policies/generate-doc`) que acepta una política y devuelve la documentación generada.
6.  Se publica un evento `PolicyDocumentationGenerated` cuando se genera una nueva documentación.

## Tareas / Subtareas
- [ ] **Tarea 1: Implementar el Servicio Generador** (AC: #1)
    - [ ] Crear la estructura `PolicyDocGenerator`.
- [ ] **Tarea 2: Implementar el Parseo de Políticas** (AC: #2, #3)
    - [ ] Utilizar el parser de la librería `cedar-policy` para descomponer una política en su AST (Árbol de Sintaxis Abstracta).
    - [ ] Escribir lógica para extraer las cláusulas (`principal`, `action`, etc.) y las anotaciones del árbol.
- [ ] **Tarea 3: Implementar la Generación de Texto** (AC: #4)
    - [ ] Crear una plantilla o lógica de formateo que construya una frase en lenguaje natural a partir de los componentes extraídos.
- [ ] **Tarea 4: Implementar el Endpoint de la API** (AC: #5)
    - [ ] Añadir e implementar el endpoint `POST /api/v1/policies/generate-doc`.
- [ ] **Tarea 5: Publicar Evento de Dominio** (AC: #6)
    - [ ] Integrar la publicación del evento `PolicyDocumentationGenerated` en el handler de la API.
- [ ] **Tarea 6: Añadir Pruebas**
    - [ ] Escribir pruebas unitarias para el generador con varias políticas de ejemplo (simples, con condiciones `when`, con anotaciones) y verificar que el texto generado es el esperado.

## Notas para el Desarrollador
Esta es una herramienta de ayuda para el administrador. Su objetivo es la claridad.

### Anotaciones de Cedar
* Cedar soporta anotaciones directamente en las políticas, lo cual es la forma preferida de añadir documentación legible por humanos. El generador debe priorizar estas anotaciones.
    ```cedar
    @doc("Permite a los desarrolladores leer artefactos en su propio proyecto.")
    permit(
      principal,
      action == Action::"read",
      resource
    )
    when {
      principal.project == resource.project
    };
    ```
* Si la anotación `@doc` existe, el generador puede usarla directamente. Si no, debe generar una descripción a partir de la estructura de la política.